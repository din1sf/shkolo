import json
from langchain_openai import ChatOpenAI
from langchain_core.prompts import ChatPromptTemplate
import os

openai_api_key = os.environ.get("OPENAI_API_KEY")
if openai_api_key is None:
    raise ValueError("OpenAI API key is not set in the environment variable OPENAI_API_KEY")
llm = ChatOpenAI(openai_api_key=openai_api_key)

# You want to compare the success, the number of grades, the number of absences, the number of reviews, the number of tests, the number of parent meetings, the place in the parallel and the place in the class. You also want to compare the grades in the different subjects. You want to compare the grades in Bulgarian language and literature, English language, Spanish language, Mathematics, Civil education, Physical education and sports, English language (IUCH - PP), Module 1 - Oral communication (IUCH - PP (task module)) (English language), Module 2 - Written communication (IUCH - PP (task module)) (English language), Module 3 - Language through literature (IUCH - PP (task module)) (English language), Module 4 - Culture and intercultural communication (IUCH - PP (task module)) (English language), Business English (IUCH - PP (elective module)) (English language), Spanish language (IUCH - PP), Module 1 - Oral communication (IUCH - PP (task module)) (Spanish language), Module 2 - Written communication (IUCH - PP (task module)) (Spanish language), Spanish language and culture through literature and new technologies (IUCH - PP (elective module)) (Spanish language), Mathematics (IUCH - PP), Module 1 - Geometry (IUCH - PP (task module)) (Mathematics), Module 2 - Elements of mathematical analysis (IUCH - PP (task module)) (Mathematics), Research tasks with parameter (IUCH - PP (elective module)) (Mathematics), Information technology (IUCH - PP), Module 1 - Data processing and analysis (IUCH - PP (task module)) (Information technology), Module 2 - Multimedia (IUCH - PP (task module)) (Information technology), Automated customer contact systems (IUCH - PP (elective module)) (Information technology), Physics and astronomy (IUCH - PP), History of astronomy (IUCH - PP (elective module)) (Physics and astronomy), Football (FUCH - DP/DUP), Sports activities (football) (…), Traffic safety (…), Class hour (…). You want to compare the grades in the different subjects. You want to compare the grades in Bulgarian language and literature, English language, Spanish language,
prompt = ChatPromptTemplate.from_messages([
    ("system", "You are a parent who wants to compare the grades of your child. You have two sets of grades {grades1} and {grades2} which are gathered from two consecutive days. You want to compare the statistics of the two sets of grades and the grades in the different subjects by give only the differences. Answers should be in English in a good understandable language. If there is no changes in the statistics just answer 'No changes in statistics'. If there is no changes in the grades in the different subjects just answer 'No changes in subjects"),
    ("user", "Compare the following grades statistics {grades1} with {grades2}")
])

chain = prompt | llm 

grades1 = "{'statistics': {'Успех': '5.65', 'Оценки': '75', 'Отсъствия': '23.50', 'Отзива': '0', 'Контролни': '6', 'Родителски': '1', 'МЯСТО В ПАРАЛЕЛКАТА': '15', 'МЯСТО ВЪВ ВИПУСКА': '102'}, 'subjects': {'Български език и литература': [], 'Английски език': ['6', '6'], 'Испански език': [], 'Математика': [], 'Гражданско образование': [], 'Физическо възпитание и спорт': [], 'Английски език (ИУЧ - ПП)': [], 'МОДУЛ 1 - Устно общуване (ИУЧ - ПП (зад. модул)) (Английски език)': [], 'МОДУЛ 2 - Писмено общуване (ИУЧ - ПП (зад. модул)) (Английски език)': [], 'МОДУЛ 3 - Езикът чрез литературата (ИУЧ - ПП (зад. модул)) (Английски език)': [], 'МОДУЛ 4 - Култура и междукултурно общуване (ИУЧ - ПП (зад. модул)) (Английски език)': [], 'Бизнес английски (ИУЧ - ПП (изб. модул)) (Английски език)': [], 'Испански език (ИУЧ - ПП)': [], 'МОДУЛ 1 - Устно общуване (ИУЧ - ПП (зад. модул)) (Испански език)': [], 'МОДУЛ 2 - Писмено общуване (ИУЧ - ПП (зад. модул)) (Испански език)': [], 'Испанският език и култура чрез литературата и новите технологии (ИУЧ - ПП (изб. модул)) (Испански език)': ['5'], 'Математика (ИУЧ - ПП)': [], 'МОДУЛ 1 - Геометрия (ИУЧ - ПП (зад. модул)) (Математика)': [], 'МОДУЛ 2 - Елементи на математическия анализ (ИУЧ - ПП (зад. модул)) (Математика)': ['6'], 'Изследователски задачи с параметър (ИУЧ - ПП (изб. модул)) (Математика)': [], 'Информационни технологии (ИУЧ - ПП)': [], 'МОДУЛ 1 - Обработка и анализ на данни (ИУЧ - ПП (зад. модул)) (Информационни технологии)': [], 'МОДУЛ 2 - Мултимедия (ИУЧ - ПП (зад. модул)) (Информационни технологии)': [], 'Автоматизирани системи за контакт с потребителите (ИУЧ - ПП (изб. модул)) (Информационни технологии)': [], 'Физика и астрономия (ИУЧ - ПП)': [], 'История на астрономията (ИУЧ - ПП (изб. модул)) (Физика и астрономия)': [], 'Футбол (ФУЧ - ДП/ДрУП)': [], 'Спортни дейности (футбол) (…)': [], 'Безопасност на движението (…)': [], 'Час на класа (…)': []}}"
grades2 = "{'statistics': {'Успех': '5.65', 'Оценки': '76', 'Отсъствия': '23.50', 'Отзива': '0', 'Контролни': '6', 'Родителски': '1', 'МЯСТО В ПАРАЛЕЛКАТА': '15', 'МЯСТО ВЪВ ВИПУСКА': '103'}, 'subjects': {'Български език и литература': [], 'Английски език': ['6', '6', '6'], 'Испански език': [], 'Математика': [], 'Гражданско образование': [], 'Физическо възпитание и спорт': ['6'], 'Английски език (ИУЧ - ПП)': [], 'МОДУЛ 1 - Устно общуване (ИУЧ - ПП (зад. модул)) (Английски език)': [], 'МОДУЛ 2 - Писмено общуване (ИУЧ - ПП (зад. модул)) (Английски език)': [], 'МОДУЛ 3 - Езикът чрез литературата (ИУЧ - ПП (зад. модул)) (Английски език)': [], 'МОДУЛ 4 - Култура и междукултурно общуване (ИУЧ - ПП (зад. модул)) (Английски език)': [], 'Бизнес английски (ИУЧ - ПП (изб. модул)) (Английски език)': [], 'Испански език (ИУЧ - ПП)': [], 'МОДУЛ 1 - Устно общуване (ИУЧ - ПП (зад. модул)) (Испански език)': [], 'МОДУЛ 2 - Писмено общуване (ИУЧ - ПП (зад. модул)) (Испански език)': [], 'Испанският език и култура чрез литературата и новите технологии (ИУЧ - ПП (изб. модул)) (Испански език)': ['5','6'], 'Математика (ИУЧ - ПП)': [], 'МОДУЛ 1 - Геометрия (ИУЧ - ПП (зад. модул)) (Математика)': [], 'МОДУЛ 2 - Елементи на математическия анализ (ИУЧ - ПП (зад. модул)) (Математика)': ['6'], 'Изследователски задачи с параметър (ИУЧ - ПП (изб. модул)) (Математика)': [], 'Информационни технологии (ИУЧ - ПП)': [], 'МОДУЛ 1 - Обработка и анализ на данни (ИУЧ - ПП (зад. модул)) (Информационни технологии)': [], 'МОДУЛ 2 - Мултимедия (ИУЧ - ПП (зад. модул)) (Информационни технологии)': [], 'Автоматизирани системи за контакт с потребителите (ИУЧ - ПП (изб. модул)) (Информационни технологии)': [], 'Физика и астрономия (ИУЧ - ПП)': [], 'История на астрономията (ИУЧ - ПП (изб. модул)) (Физика и астрономия)': [], 'Футбол (ФУЧ - ДП/ДрУП)': [], 'Спортни дейности (футбол) (…)': [], 'Безопасност на движението (…)': [], 'Час на класа (…)': []}}"

result = chain.invoke({"grades1": grades1, "grades2": grades2})

print(result.content)

